import{aM as v,bZ as y,aR as S,aP as o,fj as u,i as O,aS as m}from"./index-DBYpUVCR.js";class d{constructor(){this._currentOperationSignal=v(null)}get currentOperationType(){return this._currentOperationSignal.value?.type??null}destroy(){this.stop()}async start(p,c,h){const e=this._currentOperationSignal.value;e?.stop();const s=new AbortController,i=h?.signal,n=AbortSignal.any([s.signal,i].filter(y)),r=S();let a=!1;const l=()=>{a||(a=!0,r.reject(m()))},t={type:p,resolve:g=>{a||(a=!0,r.resolve(g))},reject:l,promise:r.promise,stop:()=>s.abort(),handles:[]};this._currentOperationSignal.value=t,t.handles.push(o(i,()=>{s.abort()}),o(n,()=>{u(t.handles),a||l()}));try{return e&&(await e.promise.catch(()=>{}),O(n)),await c(t,n),await r.promise}finally{u(t.handles),this._currentOperationSignal.value===t&&(this._currentOperationSignal.value=null)}}stop(){this._currentOperationSignal.value?.stop()}}export{d as s};
